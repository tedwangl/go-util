.PHONY: help docker-up docker-down docker-logs test-all test-single test-master-slave test-mixed test-pure clean

help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "å¯ç”¨å‘½ä»¤ï¼š"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

docker-up: ## å¯åŠ¨æ‰€æœ‰ Docker å®¹å™¨
	@echo "ğŸš€ å¯åŠ¨ Docker å®¹å™¨..."
	docker-compose up -d
	@echo "â³ ç­‰å¾…æ•°æ®åº“å°±ç»ª..."
	@sleep 15
	@echo "âœ… æ‰€æœ‰å®¹å™¨å·²å¯åŠ¨"
	@docker-compose ps

docker-down: ## åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨
	@echo "ğŸ›‘ åœæ­¢ Docker å®¹å™¨..."
	docker-compose down -v
	@echo "âœ… æ‰€æœ‰å®¹å™¨å·²åœæ­¢"

docker-logs: ## æŸ¥çœ‹å®¹å™¨æ—¥å¿—
	docker-compose logs -f

docker-ps: ## æŸ¥çœ‹å®¹å™¨çŠ¶æ€
	docker-compose ps

test-all: ## è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
	@echo "ğŸ§ª è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•..."
	go test -v -run TestIntegration

test-single: ## æµ‹è¯•åœºæ™¯ 1ï¼šå•åº“
	@echo "ğŸ§ª æµ‹è¯•åœºæ™¯ 1ï¼šå•åº“..."
	go test -v -run TestIntegration_Scenario1_SingleDB

test-master-slave: ## æµ‹è¯•åœºæ™¯ 2ï¼šä¸»ä»
	@echo "ğŸ§ª æµ‹è¯•åœºæ™¯ 2ï¼šä¸»ä»..."
	go test -v -run TestIntegration_Scenario2_MasterSlave

test-mixed: ## æµ‹è¯•åœºæ™¯ 3ï¼šæ··åˆåˆ†ç‰‡
	@echo "ğŸ§ª æµ‹è¯•åœºæ™¯ 3ï¼šæ··åˆåˆ†ç‰‡..."
	go test -v -run TestIntegration_Scenario3_MixedSharding

test-pure: ## æµ‹è¯•åœºæ™¯ 4ï¼šçº¯åˆ†ç‰‡
	@echo "ğŸ§ª æµ‹è¯•åœºæ™¯ 4ï¼šçº¯åˆ†ç‰‡..."
	go test -v -run TestIntegration_Scenario4_PureSharding

clean: ## æ¸…ç†æµ‹è¯•æ•°æ®å’Œå®¹å™¨
	@echo "ğŸ§¹ æ¸…ç†ç¯å¢ƒ..."
	docker-compose down -v
	@echo "âœ… æ¸…ç†å®Œæˆ"

setup: docker-up ## å®Œæ•´è®¾ç½®ï¼ˆå¯åŠ¨å®¹å™¨ + è¿è¡Œæµ‹è¯•ï¼‰
	@echo "â³ ç­‰å¾…æ•°æ®åº“å®Œå…¨å°±ç»ª..."
	@sleep 5
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@make test-all

quick-test: ## å¿«é€Ÿæµ‹è¯•ï¼ˆå‡è®¾å®¹å™¨å·²å¯åŠ¨ï¼‰
	@echo "ğŸ§ª å¿«é€Ÿæµ‹è¯•..."
	go test -v -run TestIntegration -timeout 30s
